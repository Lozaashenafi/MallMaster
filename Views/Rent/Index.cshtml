@using MallMinder.Data
@using MallMinder.Models
@using MallMinder.Models.ViewModels
@model MallMinder.Models.ViewModels.RentVM
@inject AppDbContext _context

@{
    int mallId = ViewBag.MallId;
    var floors = _context.Floor.Where(f => f.MallId == mallId).ToList();
    var Rooms = _context.Room
    .Where(r => _context.Floor.Any(f => f.Id == r.FloorId && f.MallId == mallId))
    .Where(r => r.Status == "free").ToList();
    var roomTypes = _context.RentType.ToList();
}

<div class="col-12 grid-margin">
    <div class="card">
        <div class="card-body">
            <h4 class="card-title">Rent</h4>
            <form class="form-sample" method="Post" asp-action="Index" asp-asp-controller="Rent">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group row">
                            <label class="col-sm-3 col-form-label">User Name</label>
                            <div class="col-sm-9">
                                <input asp-for="TenantUserName" type="text" class="form-control">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group row">
                            <label class="col-sm-4 col-form-label">Payment Duration</label>
                            <div class="col-sm-7">
                                <input asp-for="PaymentDuration" type="number" class="form-control">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group row">
                            <label class="col-sm-3 col-form-label">Free Room</label>
                            <div class="col-sm-9">
                                <select asp-for="RoomId" class="form-control" id="freeRoomDropdown">
                                    @foreach (var room in Rooms)
                                    {
                                        var floor = _context.Floor.FirstOrDefault(f => f.Id == room.FloorId);

                                        if (floor != null)
                                        {
                                            <option value="@room.Id">@room.RoomNumber - @floor.FloorNumber</option>
                                        }
                                        else
                                        {
                                            <option value="@room.Id">@room.RoomNumber - Floor Not Found</option>
                                        }
                                    }
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group row">
                            <label class="col-sm-3 col-form-label">Rental Date</label>
                            <div class="col-sm-9">
                                <input asp-for="RentalDate" class="form-control" placeholder="dd/mm/yyyy">
                            </div>
                        </div>
                    </div>
                </div>

                <p class="card-description">Choose Rental type </p>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-check form-check-primary">
                            <label class="form-check-label">
                                <input asp-for="StatusTag" type="radio" class="form-check-input rental-type-radio"
                                    name="rentalType" data-dropdown="#shopsStoresDropdown" checked> Shops and Stores <i
                                    class="input-helper"></i></label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-check form-check-primary">
                            <label class="form-check-label">
                                <input asp-for="StatusTag" type="radio" class="form-check-input rental-type-radio"
                                    name="rentalType" data-dropdown="#foodDrinkDropdown"> Food and Drink <i
                                    class="input-helper"></i></label>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group row">
                            <label class="col-sm-3 col-form-label"></label>
                            <div class="col-sm-9">
                                <select class="form-control rental-type-dropdown" id="shopsStoresDropdown" disabled>
                                    @foreach (var roomType in roomTypes)
                                    {
                                        if (roomType.Tag == "Shops and Stores")
                                        {
                                            <option value="@roomType.Id">@roomType.Type</option>
                                        }
                                    }
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group row">
                            <label class="col-sm-3 col-form-label"></label>
                            <div class="col-sm-9">
                                <select class="form-control rental-type-dropdown" id="foodDrinkDropdown" disabled>
                                    @foreach (var roomType in roomTypes)
                                    {
                                        if (roomType.Tag == "Food and Drink")
                                        {
                                            <option value="@roomType.Id">@roomType.Type</option>
                                        }
                                    }
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-check form-check-primary">
                            <label class="form-check-label">
                                <input asp-for="StatusTag" type="radio" class="form-check-input rental-type-radio"
                                    data-dropdown="#servicesDropdown"> Services<i class="input-helper"></i></label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-check form-check-primary">
                            <label class="form-check-label">
                                <input asp-for="StatusTag" type="radio" class="form-check-input rental-type-radio"
                                    data-dropdown="#entertainmentDropdown"> Entertainment<i
                                    class="input-helper"></i></label>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group row">
                            <label class="col-sm-3 col-form-label"></label>
                            <div class="col-sm-9">
                                <select class="form-control rental-type-dropdown" id="servicesDropdown" disabled>
                                    @foreach (var roomType in roomTypes)
                                    {
                                        if (roomType.Tag == "Services")
                                        {
                                            <option value="@roomType.Id">@roomType.Type</option>
                                        }
                                    }
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group row">
                            <label class="col-sm-3 col-form-label"></label>
                            <div class="col-sm-9">
                                <select class="form-control rental-type-dropdown" id="entertainmentDropdown" disabled>
                                    @foreach (var roomType in roomTypes)
                                    {
                                        if (roomType.Tag == "Entertainment")
                                        {
                                            <option value="@roomType.Id">@roomType.Type</option>
                                        }
                                    }
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-check form-check-primary">
                            <label asp-for="StatusTag" class="form-check-label">
                                <input type="radio" class="form-check-input rental-type-radio" name="rentalType"
                                    data-dropdown="#otherDropdown"> Other<i class="input-helper"></i></label>
                        </div>
                    </div>

                </div>
                <div class="row">

                    <div class="col-md-6">
                        <div class="form-group row">
                            <label class="col-sm-3 col-form-label"></label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" id="otherRentType" placeholder="Other">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group row">
                            <div class="col-sm-9">
                                <button type="button" class="btn btn-primary btn-rounded btn-fw">Submit</button>
                                <button type="button" class="btn btn-rounded btn-outline-light btn-fw">Cancel</button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

@section scripts {
    <script>
        $(document).ready(function () {
            // Function to toggle dropdowns based on selected radio button
            $('.rental-type-radio').change(function () {
                var dropdownId = $(this).data('dropdown');
                $('.rental-type-dropdown').prop('disabled', true);
                $(dropdownId).prop('disabled', false);
            });
        });
    </script>

    <style>
        /* Style for disabled dropdowns */
        .rental-type-dropdown:disabled {
            opacity: 1;
            background-color: #2a3038;

        }
    </style>
}
